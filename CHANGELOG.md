# 更新日志 (Changelog)

## v1.2.0 (2025-11-15)

### ✨ 新功能

#### 自动更新检查 🆕
- 应用启动时自动检查 GitHub 上的新版本
- 每 24 小时最多检查一次,避免频繁请求 API
- 智能版本号对比,自动判断是否有新版本
- 支持"稍后再说"功能,用户可选择忽略某个版本
- 支持强制更新模式（重要更新）
- 精美的 Material Design 3 风格更新对话框
- 完整多语言支持（简中/繁中/英语/日语）

#### 智能架构检测 🔥
- 自动检测设备 CPU 架构（arm64-v8a、armeabi-v7a、x86、x86_64）
- 自动下载最适合设备的 APK 版本
- 支持回退到通用版本（universal）
- 向后兼容旧版本的单 APK 格式
- 优化下载大小,节省流量

#### 手动检查更新 ⚡
- 在设置界面新增"检查更新"选项
- 手动检查时忽略 24 小时限制
- 自动忽略已忽略的版本,重新检查所有更新
- 显示友好的提示信息（已是最新版本/发现新版本）
- 支持在"关于与许可"页面直接跳转 GitHub 仓库

#### 文件打开功能增强 📂
- 完善的文件打开功能,支持打开已下载的文件
- 详细的调试日志输出,便于排查问题
- 智能 MIME 类型检测和回退机制
- 支持查询可打开文件的应用列表
- APK 文件特殊处理,检测安装权限状态
- 完善的 FileProvider 路径配置

#### 自动下载安装 📥
- 使用系统 DownloadManager 下载更新包
- 下载完成后自动打开安装界面
- 显示下载进度通知
- 根据设备架构自动选择最优 APK

### 🐛 Bug 修复

#### APK 安装权限修复 ✅
- **修复打开 APK 文件时的权限错误**
- 在 AndroidManifest.xml 中添加 `REQUEST_INSTALL_PACKAGES` 权限
- 修复调用 `canRequestPackageInstalls()` API 时的 SecurityException
- 完善 APK 文件安装流程的权限检查
- 添加详细的权限状态日志输出

#### FileProvider 配置优化
- 更新 `file_paths.xml`,支持更多路径
- 添加公共 Download 目录支持
- 添加应用私有目录支持
- 添加外部存储根目录支持
- 添加缓存目录支持

### 🔧 优化改进

#### 用户体验优化
- 更新对话框显示版本号和更新时间
- 强制更新时隐藏"稍后再说"按钮
- 添加 GitHub 项目链接按钮
- 优化更新检查的频率控制
- 改进错误提示信息

#### 代码质量
- 添加完整的日志系统,便于调试
- 优化异常处理机制
- 改进文件打开的错误处理
- 增强网络请求的容错性
- 添加详细的代码注释和文档

#### 性能优化
- 使用协程优化更新检查的异步处理
- 减少不必要的网络请求
- 优化版本信息缓存机制
- 改进 JSON 解析性能

### 📦 版本信息
- 版本号: `1.2.0`
- 版本代码: `3`
- 更新日期: 2025-11-15

### 🌐 支持的语言
- 简体中文 (zh-CN)
- 繁体中文 (zh-TW)
- English (en)
- 日本語 (ja)

---

## v1.1.0 (2025-01-14)

### ✨ 新功能

#### 批量下载
- 新建下载对话框支持添加多个下载链接
- 点击"添加更多链接"按钮可动态添加 URL 输入框
- 每个额外的 URL 输入框都可以单独删除
- 批量下载时自动为每个链接创建独立的下载任务
- 显示批量下载提示："批量下载：已添加 X 个链接"

#### 预测性返回手势 (Android 13+)
- 支持系统级预测性返回手势,可在返回前预览动画
- 侧边栏支持预测性返回手势
- 搜索界面支持预测性返回手势
- 设置和许可页面支持预测性返回手势
- 对话框支持预测性返回手势

#### 状态栏沉浸式效果
- 实现 Edge-to-Edge 沉浸式显示
- 状态栏和导航栏完全透明
- 所有页面正确处理系统栏 insets,避免内容被遮挡
- 优化侧边栏的状态栏适配

#### 页面切换动画
- 主页、设置、许可页面之间的切换添加平滑的滑动动画
- 使用 Material Design 推荐的过渡效果
- 提升用户体验的流畅度

#### 多语言支持增强
- 下载对话框完全支持多语言
- "关于与许可"页面完全支持多语言
- 所有开源库描述支持多语言
- 新增字符串资源：
  - `add_more_links` - 添加更多链接
  - `batch_download_hint` - 批量下载提示
  - `filename_only_first` - 文件名仅应用于首个链接的说明
  - `open_source_licenses` - 开源许可
  - `using_open_source_projects` - 使用的开源项目说明
  - `thanks_to_contributors` - 致谢开源贡献者
  - 各开源库的描述字符串

### 🐛 Bug 修复

#### 导航栈问题修复
- 修复从设置/许可页面返回主页后,点击新建下载显示白屏的问题
- 优化导航逻辑,移除不必要的 `launchSingleTop` 标志
- 简化返回栈管理,使用 Navigation Compose 的默认行为

#### 重新下载功能修复
- **修复已完成任务无法重新下载的问题**
- 重新下载时会:
  - 删除已下载的文件
  - 清除所有分片记录
  - 重置下载进度数据
  - 重新初始化并启动下载
- 区分处理"失败任务重试"和"已完成任务重新下载"两种场景

#### 资源文件错误修复
- 修复 `open_source_licenses` 字符串在所有语言文件中重复定义的问题
- 修复 `lib_gson_desc` 中特殊字符导致的编译错误
- 修复 `getOpenSourceLibraries()` 函数缺少 `@Composable` 注解导致的编译错误

### 🔧 优化改进

#### UI/UX 优化
- 下载对话框宽度优化,设置为屏幕宽度的 92%
- 下载对话框支持自定义宽度,不使用平台默认宽度
- 对话框支持点击外部和返回键关闭

#### 代码质量
- 添加详细的日志输出,便于调试
- 优化错误处理逻辑
- 改进状态管理和数据流

### 📦 版本信息
- 版本号: `1.1.0`
- 版本代码: `2`
- 编译日期: 2025-01-14

### 🌐 支持的语言
- 简体中文 (zh-CN)
- 繁体中文 (zh-TW)
- English (en)
- 日本語 (ja)

---

## v1.0.0 (初始版本)

### 核心功能
- 多线程下载支持
- 断点续传
- 下载任务管理
- 自定义保存位置
- User-Agent 设置
- 剪贴板监听
- Firebase Analytics (可选)


